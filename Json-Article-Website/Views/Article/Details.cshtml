 @model ArticleDetailsModel
@{
    ViewData["Title"] = Model.Title;
    var user = @Context.Request.GetLoginCookie();

	Model.Summary = Model.Summary ?? "No summary available for this article.";

}

@section HeadContent {
    <meta name="description" content="@Model.Summary">
    <meta name="keywords" content="@Model.Keywords">
    <meta name="author" content="@Model.Author">
    <meta property="og:title" content="@Model.Title">
    <meta property="og:description" content="@Model.Summary">
    <meta property="og:image" content="@($"{Context.Request.Scheme}://{Context.Request.Host}{Model.ImageUrl}")" />

    <meta property="og:url" content="@Url.Action("Details", "Article", new { id = Model.Id, slug = Model.Slug }, Context.Request.Scheme)">
}

<section class="d-flex justify-content-between  flex-column flex-lg-row gap-3">


    @if (!Model.IsPublished && !user.IsAuthenticated)
    {
        <!-- Under Reviev-->
        <div class="text-center w-100 my-5">

            <h1 class="display-2 fw-bold">Under Review</h1>
			<p class="text-muted">This article is currently under review and cannot be viewed by the public.</p>
			<p class="text-muted">
				If you are the author, please check back later or contact the site administrator for more information.
            </p>
            <a asp-action="articles" class="btn btn-primary rounded-pill px-4">
                <span class="bi bi-arrow-left"></span>
                <span>Back to Articles</span>
            </a>
        </div>
    }
    else
    {
        <section class="d-flex flex-column flex-md-row gap-3 flex-column-reverse">
            <asidecle class="position-sticky shadow-sm p-3">
                <div>
                    <div class="d-flex flex-row flex-md-column justify-content-around align-items-center align-content-center menu mt-auto mt-md-5">

                    </div>
                </div>

            </asidecle>
            <article class="article-details mx-lg-5 px-lg-5">

                <!-- show image -->
                @if (!string.IsNullOrEmpty(Model.ImageUrl))
                {
                    <figure class="article-image0 mb-3 text-center">
                        <img src="@Model.ImageUrl" alt="Article Image" class="img-fluid rounded" width="1000" height="450">
                    </figure>
                }

                <h1 class="article-title display-4 fw-bold">@Model.Title</h1>
                <p class=" d-flex flex-wrap gap-2 gap-md-3 my-3">
                    <span data-tooltip-text="@Model.PublishedDate?.ToString("MMMM dd yyyy, hh:mm tt")" class="article-date">
                        <span class="bi bi-calendar"></span>
                        <span>@Model.PublishedDate.TimeAgo()</span>
                    </span>
                    <span class="article-views">
                        <span class="bi bi-eye-fill"></span>
                        <span>@Model.Views.ToAbbreviated() Views</span>
                    </span>
                    <span class="article-likes">
                        <span class="bi bi-heart"></span>
                        <span>@Model.Likes.ToAbbreviated() Likes</span>
                    </span>
                    <span class="article-read-time">
                        <span class="bi bi-clock-fill"></span>
                        <span>@Model.ReadingTime.ToEstimatedReadTimeString()</span>
                    </span>
                </p>

                <div class="article-content mt-5">
                    @Html.Raw(Model.Content)
                </div>
            </article>
        </section>
    }

    @* <aside class="overflow-y-auto d-none d-lg-block">
        <div style="min-width: max-content">
            <h5>Table Content </h5>
            <hr/>
            <div id="table-content"></div>
        </div>
    </aside> *@
</section>

@* @section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Select the article content
            const content = document.querySelector('.article-content');
            if (!content) return;

            // Find all headings (h1-h6) inside the content
            const headings = content.querySelectorAll('h1, h2, h3, h4, h5, h6');
            if (headings.length === 0) return;

            // Create TOC container
            const toc = document.createElement('nav');
            toc.className = 'table-of-contents';
            const list = document.createElement('ul');

            headings.forEach(function (heading, idx) {
                // Ensure each heading has an id for anchor links
                if (!heading.id) {
                    heading.id = 'heading-' + idx;
                }
                const li = document.createElement('li');
                li.style.marginLeft = ((parseInt(heading.tagName[1]) - 1) * 20) + 'px'; // Indent by heading level
                const a = document.createElement('a');
                a.href = '#' + heading.id;
                a.textContent = heading.textContent;
                li.appendChild(a);
                list.appendChild(li);
            });

            toc.appendChild(list);

            const table_content = document.querySelector('#table-content');
            if (!table_content) return;

            // Clear previous content and append the TOC element
            table_content.innerHTML = '';
            table_content.appendChild(toc);
        });
    </script>
} *@

@section Scripts{
	<script defer src="/js/article-link-scraper.js" asp-append-version="true"></script>
}